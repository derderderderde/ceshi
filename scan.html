<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>产品扫描验证</title>
    <style>
        #reader {
            width: 300px;
            margin: auto;
        }
        video {
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>欢迎来到产品页面</h1>
    <p>请扫描二维码以验证您的访问...</p>

    <!-- 用于显示二维码扫描的窗口 -->
    <div id="reader"></div>

    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
    <script>
        const validProducts = {
            'pro1': 'pro1.html',
            'pro2': 'pro2.html',
            'pro3': 'pro3.html'
        };

        function redirectToProduct(product) {
            if (validProducts[product]) {
                window.location.href = validProducts[product];
            } else {
                document.body.innerHTML = '<h2>无效的二维码！</h2>';
            }
        }

        function onScanSuccess(decodedText, decodedResult) {
            // 解析URL参数
            const urlParams = new URLSearchParams(decodedText);
            const productParam = urlParams.get('product');
            if (productParam) {
                redirectToProduct(productParam);
            } else {
                document.body.innerHTML = '<h2>二维码不包含有效的产品信息。</h2>';
            }
        }

        function onScanFailure(error) {
            console.warn(`扫描失败: ${error}`);
        }

        // 请求摄像头权限并开始二维码扫描
        function startScanning() {
            navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
                .then(function(stream) {
                    let html5QrcodeScanner = new Html5QrcodeScanner(
                        "reader", { fps: 10, qrbox: 250 });
                    html5QrcodeScanner.render(onScanSuccess, onScanFailure);
                })
                .catch(function(err) {
                    document.body.innerHTML = '<h2>无法访问摄像头，请检查权限设置或使用支持摄像头的设备。</h2>';
                    console.error("Error accessing camera: ", err);
                });
        }

        // 启动扫描
        startScanning();
    </script>
</body>
</html>
